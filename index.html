<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Concept Studio - 3D Building Designer</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Mobile Console Debugger (Remove after debugging) -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        // Only show console on mobile devices
        if (window.innerWidth < 1025) {
            eruda.init();
        }
    </script>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
  <!-- LEFT SIDEBAR - Design Tools -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Concept Studio</h2>
      <button id="sidebar-toggle" class="icon-btn" title="Toggle Sidebar">‚ò∞</button>
    </div>

    <!-- PROMINENT GENERATE BUTTON -->
    <div class="sidebar-hero-section">
      <button id="upscale-3d-btn" class="btn-hero-generate">
        <span class="hero-icon">‚ú®</span>
        <div class="hero-text">
          <span class="hero-title">Generate Photos</span>
          <span class="hero-subtitle">AI-Powered Renders</span>
        </div>
      </button>
      <p id="upscale-status" class="status-text"></p>
    </div>

    <!-- SECTION: Drawing Tools -->
    <div class="sidebar-section">
      <h3 class="section-title">üé® Drawing & Editing</h3>
      <div class="tool-grid">
        <button id="mode-draw" class="tool-btn active" title="Draw Walls">
          <span class="tool-icon">‚úèÔ∏è</span>
          <span class="tool-label">Draw Walls</span>
        </button>
        <button id="mode-edit" class="tool-btn" title="Edit">
          <span class="tool-icon">‚úÇÔ∏è</span>
          <span class="tool-label">Edit</span>
        </button>
        <button id="mode-door" class="tool-btn" title="Add Doors">
          <span class="tool-icon">üö™</span>
          <span class="tool-label">Doors</span>
        </button>
        <button id="mode-window" class="tool-btn" title="Add Windows">
          <span class="tool-icon">ü™ü</span>
          <span class="tool-label">Windows</span>
        </button>
        <button id="mode-patio" class="tool-btn" title="Add Patio">
          <span class="tool-icon">üè°</span>
          <span class="tool-label">Patio</span>
        </button>
      </div>
    </div>

    <!-- SECTION: Floor Management -->
    <div class="sidebar-section collapsible">
      <h3 class="section-title collapsible-header">
        <span>üè¢ Floor Management</span>
        <span class="collapse-icon">‚ñº</span>
      </h3>
      <div class="collapsible-content">
        <div class="input-group">
          <label>Current Floor:</label>
          <select id="floor-selector">
            <option value="0" selected>Floor 1</option>
          </select>
        </div>
        <button id="add-floor" class="btn-secondary full-width">+ Add Floor</button>
        <label class="checkbox-label">
          <input type="checkbox" id="show-floor-overlay" checked>
          <span>Show Floor Below</span>
        </label>
        
        <div class="input-group" style="margin-top: 16px;">
          <label>Wall Height: <span id="wall-height-value" class="value-badge">8ft</span></label>
          <input type="range" id="wall-height" min="8" max="12" step="0.5" value="8" class="slider" style="width: 100%;">
        </div>
      </div>
    </div>

    <!-- SECTION: Doors & Windows -->
    <div class="sidebar-section collapsible">
      <h3 class="section-title collapsible-header">
        <span>üö™ Doors & Windows</span>
        <span class="collapse-icon">‚ñº</span>
      </h3>
      <div class="collapsible-content">
        <div class="input-group">
          <label>Door Style:</label>
          <select id="door-style">
            <option value="swing" selected>Swing Door (3')</option>
            <option value="pocket">Pocket Door (3')</option>
            <option value="bifold">Bifold Door (4')</option>
            <option value="double">Double Door (6')</option>
          </select>
        </div>
        <p class="help-text">üí° Press F to flip door swing direction</p>
      </div>
    </div>

    <!-- SECTION: Roof Settings -->
    <div class="sidebar-section collapsible">
      <h3 class="section-title collapsible-header">
        <span>üè† Roof Settings</span>
        <span class="collapse-icon">‚ñº</span>
      </h3>
      <div class="collapsible-content">
        <label class="checkbox-label">
          <input type="checkbox" id="floor-has-roof">
          <span>Add Roof to Current Floor</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="show-roof" checked>
          <span>Show Roof in 3D</span>
        </label>

        <div class="input-group">
          <label>Roof Style:</label>
          <select id="roof-style">
            <option value="hip" selected>Hip Roof</option>
            <option value="gable">Gable Roof</option>
            <option value="flat">Flat Roof</option>
          </select>
        </div>

        <div class="input-group">
          <label>Pitch: <span id="roof-pitch-value" class="value-badge">6:12</span></label>
          <input type="range" id="roof-pitch" min="4" max="12" step="1" value="6" class="slider" style="width: 100%;">
        </div>

        <div class="input-group">
          <label>Overhang: <span id="roof-overhang-value" class="value-badge">1.0 ft</span></label>
          <input type="range" id="roof-overhang" min="0" max="3" step="0.5" value="1" class="slider" style="width: 100%;">
        </div>
      </div>
    </div>

    <!-- SECTION: Patio Options -->
    <div class="sidebar-section collapsible">
      <h3 class="section-title collapsible-header">
        <span>üè° Patio Options</span>
        <span class="collapse-icon">‚ñº</span>
      </h3>
      <div class="collapsible-content">
        <label class="checkbox-label">
          <input type="checkbox" id="patio-has-roof">
          <span>Add Roof to Patio</span>
        </label>
        
        <div class="input-group">
          <label>Patio Roof Style:</label>
          <select id="patio-roof-style">
            <option value="flat" selected>Flat Roof</option>
            <option value="gable">Gable Roof</option>
            <option value="hip">Hip Roof</option>
          </select>
        </div>
      </div>
    </div>

    <!-- SECTION: Model Stats -->
    <div class="sidebar-section collapsible">
      <h3 class="section-title collapsible-header">
        <span>üìä Model Stats</span>
        <span class="collapse-icon">‚ñº</span>
      </h3>
      <div class="collapsible-content">
        <div class="stat-grid">
          <div class="stat-card">
            <span class="stat-card-value" id="stat-floors">1</span>
            <span class="stat-card-label">Floors</span>
          </div>
          <div class="stat-card">
            <span class="stat-card-value" id="stat-walls">0</span>
            <span class="stat-card-label">Walls</span>
          </div>
          <div class="stat-card">
            <span class="stat-card-value" id="stat-doors">0</span>
            <span class="stat-card-label">Doors</span>
          </div>
          <div class="stat-card">
            <span class="stat-card-value" id="stat-windows">0</span>
            <span class="stat-card-label">Windows</span>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION: Actions -->
    <div class="sidebar-section">
      <h3 class="section-title">‚ö° Actions</h3>
      <button id="undo" class="btn-secondary full-width">‚Ü©Ô∏è Undo</button>
      <button id="export-design" class="btn-secondary full-width">üíæ Export</button>
      <button id="clear-plan" class="btn-danger full-width">üóëÔ∏è Clear Plan</button>
    </div>
  </div>

  <!-- Floating Toggle Button (appears when sidebar is collapsed) -->
  <button id="floating-toggle" class="floating-toggle" title="Open Sidebar">‚ò∞</button>

  <!-- TOP TOOLBAR - Simplified -->
  <div class="top-toolbar">
    <div class="toolbar-left">
      <h1 class="app-title">Concept Studio</h1>
    </div>
    <div class="toolbar-right">
      <span class="info-text">üí° All controls in left sidebar</span>
    </div>
  </div>

  <!-- MAIN CONTENT AREA -->
  <div class="main-content">
    <!-- SPLIT VIEW CONTAINER -->
    <div class="split-container">
      <!-- LEFT: 2D Canvas -->
      <div class="canvas-container-2d">
        <canvas id="floor-plan-canvas"></canvas>
        <div class="canvas-info">
          <p>üìè Walls: <span id="wall-count">0</span> | Length: <span id="total-length">0</span> ft</p>
        </div>
        <!-- Floating Quick Undo Button (appears when drawing or editing) -->
        <button id="quick-undo" class="quick-undo-btn" style="display: none;" title="Undo Last Action (Ctrl+Z)">
          <span class="undo-icon">‚Ü©Ô∏è</span>
          <span class="undo-text">Undo</span>
        </button>
      </div>

      <!-- RIGHT: 3D Viewer -->
      <div class="canvas-container-3d">
        <canvas id="three-canvas"></canvas>
        <div class="canvas-info-3d">
          <div class="info-title">üéÆ 3D Controls</div>
          <ul class="control-list">
            <li>Left Click + Drag: Rotate</li>
            <li>Right Click + Drag: Pan</li>
            <li>Scroll: Zoom</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- MOBILE LAYOUT (shown only on screens < 1025px) -->
  <div class="mobile-layout">
    <!-- Top Header Bar -->
    <div class="mobile-header">
      <button id="mobile-menu-btn" class="mobile-icon-btn" aria-label="Open Menu">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18"/>
        </svg>
      </button>
      <h1 class="mobile-title">Concept Studio</h1>
      <button id="mobile-header-generate-btn" class="mobile-generate-btn" aria-label="Generate Image">
        <span class="generate-icon">‚ú®</span>
        <span class="generate-text">Generate</span>
      </button>
    </div>

    <!-- Canvas Container (Full Screen) -->
    <div class="mobile-canvas-container">
      <canvas id="mobile-canvas-2d"></canvas>
      <canvas id="mobile-canvas-3d"></canvas>
      
      <!-- 2D/3D View Toggle (Floating) -->
      <div class="view-switcher">
        <button class="view-btn active" data-view="2d">
          <span>üìê</span>
          <span>2D Plan</span>
        </button>
        <button class="view-btn" data-view="3d">
          <span>üè†</span>
          <span>3D View</span>
        </button>
      </div>

      <!-- 3D Controls Hint -->
      <div class="controls-hint" style="display: none;">
        <p>üëÜ Pinch to zoom ‚Ä¢ Drag to rotate</p>
      </div>
      
      <!-- Mobile Quick Undo Button (always visible on mobile) -->
      <button id="mobile-quick-undo" class="quick-undo-btn" title="Undo Last Action">
        <span class="undo-icon">‚Ü©Ô∏è</span>
        <span class="undo-text">Undo</span>
      </button>
    </div>

    <!-- Bottom Tool Sheet -->
    <div class="bottom-sheet" id="mobile-tools-sheet">
      <div class="sheet-handle"></div>
      
      <div class="sheet-header">
        <h3 class="sheet-title">Tools</h3>
        <button class="sheet-close" aria-label="Close">‚úï</button>
      </div>

      <!-- Tool Tabs -->
      <div class="tool-tabs">
        <button class="tab-btn active" data-tab="draw">
          <span class="tab-icon">‚úèÔ∏è</span>
          <span class="tab-label">Draw</span>
        </button>
        <button class="tab-btn" data-tab="edit">
          <span class="tab-icon">‚úÇÔ∏è</span>
          <span class="tab-label">Edit</span>
        </button>
        <button class="tab-btn" data-tab="doors-windows">
          <span class="tab-icon">üö™</span>
          <span class="tab-label">Doors/Windows</span>
        </button>
        <button class="tab-btn" data-tab="floors">
          <span class="tab-icon">üè¢</span>
          <span class="tab-label">Floors</span>
        </button>
        <button class="tab-btn" data-tab="roof-3d">
          <span class="tab-icon">üè†</span>
          <span class="tab-label">3D/Roof</span>
        </button>
        <button class="tab-btn" data-tab="patios">
          <span class="tab-icon">üè°</span>
          <span class="tab-label">Patios</span>
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content-container">
        
        <!-- DRAW TAB -->
        <div class="tab-content active" data-content="draw">
          <div class="mobile-section-title">Drawing Tools</div>
          <button class="mobile-tool-btn-wide active" data-mode="draw">
            <span>‚úèÔ∏è</span> Draw Walls
          </button>
          <div class="mobile-help-text">
            Tap and drag to draw wall segments. Double-tap or press Enter to finish.
          </div>
          
          <div class="mobile-section-title" style="margin-top: 24px;">Quick Actions</div>
          <button id="mobile-clear-plan" class="mobile-btn-danger full-width">
            <span>üóëÔ∏è</span> Clear Entire Plan
          </button>
        </div>

        <!-- EDIT TAB -->
        <div class="tab-content" data-content="edit">
          <div class="mobile-section-title">Edit Mode</div>
          <button class="mobile-tool-btn-wide" data-mode="show-all">
            <span>üëÅÔ∏è</span> Show All Editable
          </button>
          <div class="mobile-help-text">
            Tap walls, doors, windows, or patios to select and edit them. Press Delete to remove selected items.
          </div>
        </div>

        <!-- DOORS & WINDOWS TAB -->
        <div class="tab-content" data-content="doors-windows">
          <div class="mobile-section-title">Doors</div>
          <button class="mobile-tool-btn-wide" data-mode="door">
            <span>üö™</span> Place Door on Wall
          </button>
          <div class="mobile-input-group">
            <label>Door Style:</label>
            <select id="mobile-door-style" class="mobile-select">
              <option value="swing">Swing Door (3')</option>
              <option value="pocket">Pocket Door (3')</option>
              <option value="bifold">Bifold Door (4')</option>
              <option value="double">Double Door (6')</option>
            </select>
          </div>
          <div class="mobile-help-text">
            Tap on any wall to place a door. Press F to flip door direction.
          </div>

          <div class="mobile-section-title" style="margin-top: 24px;">Windows</div>
          <button class="mobile-tool-btn-wide" data-mode="window">
            <span>ü™ü</span> Place Window on Wall
          </button>
          <div class="mobile-help-text">
            Tap on any wall to place a window.
          </div>
        </div>

        <!-- FLOORS TAB -->
        <div class="tab-content" data-content="floors">
          <div class="mobile-section-title">Floor Management</div>
          <div class="mobile-input-group">
            <label>Current Floor:</label>
            <select id="mobile-floor-selector" class="mobile-select">
              <option value="0">Floor 1</option>
            </select>
          </div>
          <button id="mobile-add-floor" class="mobile-btn-secondary full-width">
            <span>‚ûï</span> Add New Floor
          </button>

          <div class="mobile-section-title" style="margin-top: 24px;">Floor Settings</div>
          <div class="mobile-input-group">
            <label>Wall Height: <span id="mobile-wall-height-value" class="value-badge">8 ft</span></label>
            <input type="range" id="mobile-wall-height" min="8" max="12" step="0.5" value="8" class="mobile-slider">
          </div>

          <div class="mobile-checkbox-group">
            <label class="mobile-checkbox-label">
              <input type="checkbox" id="mobile-show-floor-overlay" checked>
              <span>Show Floor Below as Overlay</span>
            </label>
          </div>
        </div>

        <!-- 3D & ROOF TAB -->
        <div class="tab-content" data-content="roof-3d">
          <div class="mobile-section-title">Roof Settings (Current Floor)</div>
          
          <div class="mobile-checkbox-group">
            <label class="mobile-checkbox-label">
              <input type="checkbox" id="mobile-floor-has-roof">
              <span>Add Roof to This Floor</span>
            </label>
            <label class="mobile-checkbox-label">
              <input type="checkbox" id="mobile-show-roof" checked>
              <span>Show Roof in 3D View</span>
            </label>
          </div>

          <div class="mobile-input-group">
            <label>Roof Style:</label>
            <select id="mobile-roof-style" class="mobile-select">
              <option value="hip" selected>Hip Roof</option>
              <option value="gable">Gable Roof</option>
              <option value="flat">Flat Roof</option>
            </select>
          </div>

          <div class="mobile-input-group">
            <label>Roof Pitch: <span id="mobile-roof-pitch-value" class="value-badge">6:12</span></label>
            <input type="range" id="mobile-roof-pitch" min="4" max="12" step="1" value="6" class="mobile-slider">
            <div class="mobile-help-text">Higher pitch = steeper roof</div>
          </div>

          <div class="mobile-input-group">
            <label>Roof Overhang: <span id="mobile-roof-overhang-value" class="value-badge">1.0 ft</span></label>
            <input type="range" id="mobile-roof-overhang" min="0" max="3" step="0.5" value="1" class="mobile-slider">
            <div class="mobile-help-text">Distance roof extends beyond walls</div>
          </div>

          <div class="mobile-section-title" style="margin-top: 24px;">AI Enhancement</div>
          <button id="mobile-upscale-3d" class="mobile-btn-secondary full-width" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; font-size: 16px; font-weight: 700; border: none;">
            üì∏ Upscale 3D Model
          </button>
          <p id="mobile-upscale-status" style="font-size: 12px; margin-top: 8px; text-align: center; color: #6b7280; min-height: 18px;"></p>

          <div class="mobile-section-title" style="margin-top: 24px;">Export</div>
          <button id="mobile-export-design" class="mobile-btn-secondary full-width">üì• Export Design</button>
        </div>

        <!-- PATIOS TAB -->
        <div class="tab-content" data-content="patios">
          <div class="mobile-section-title">Add Patio/Deck</div>
          <button class="mobile-tool-btn-wide" data-mode="patio">
            <span>üè°</span> Draw Patio Rectangle
          </button>
          <div class="mobile-help-text">
            Tap and drag to create a patio or deck area.
          </div>

          <div class="mobile-section-title" style="margin-top: 24px;">Patio Roof Options</div>
          <div class="mobile-checkbox-group">
            <label class="mobile-checkbox-label">
              <input type="checkbox" id="mobile-patio-has-roof">
              <span>Add Roof to Patio</span>
            </label>
          </div>

          <div class="mobile-input-group">
            <label>Patio Roof Style:</label>
            <select id="mobile-patio-roof-style" class="mobile-select">
              <option value="flat" selected>Flat Roof</option>
              <option value="gable">Gable Roof</option>
              <option value="hip">Hip Roof</option>
            </select>
          </div>
        </div>

      </div>
    </div>

    <!-- Side Menu -->
    <div class="side-menu" id="mobile-side-menu">
      <div class="side-menu-header">
        <h2>Menu</h2>
        <button class="side-menu-close" aria-label="Close Menu">‚úï</button>
      </div>
      <nav class="side-menu-nav">
        <button class="menu-item" data-action="new-plan">
          <span>üìÑ</span> New Plan
        </button>
        <button class="menu-item" data-action="export">
          <span>üì•</span> Export Design
        </button>
        <button class="menu-item" data-action="help">
          <span>‚ùì</span> Help
        </button>
      </nav>
    </div>

    <!-- Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>
  </div>

  <!-- Debug Script -->
  <script>
    console.log('=== LAYOUT DEBUG ===');
    console.log('Window size:', window.innerWidth, 'x', window.innerHeight);
    console.log('Device pixel ratio:', window.devicePixelRatio);
    
    setTimeout(() => {
        const mobileLayout = document.querySelector('.mobile-layout');
        const sidebar = document.querySelector('.sidebar');
        const toolbar = document.querySelector('.top-toolbar');
        
        console.log('Mobile layout display:', mobileLayout ? window.getComputedStyle(mobileLayout).display : 'NOT FOUND');
        console.log('Sidebar display:', sidebar ? window.getComputedStyle(sidebar).display : 'NOT FOUND');
        console.log('Toolbar display:', toolbar ? window.getComputedStyle(toolbar).display : 'NOT FOUND');
        console.log('Mobile layout exists?', !!mobileLayout);
        console.log('2D Canvas exists?', !!document.getElementById('mobile-canvas-2d'));
        console.log('3D Canvas exists?', !!document.getElementById('mobile-canvas-3d'));
    }, 500);
  </script>

  <!-- Lead Generation Modal - MUST BE OUTSIDE .mobile-layout -->
  <div class="lead-modal-overlay" id="leadModal">
    <div class="lead-modal-content">
      <button class="lead-close-btn" onclick="window.closeLeadModal()">&times;</button>

      <div class="lead-modal-header">
        <div class="lead-modal-icon">üè†‚ú®</div>
        <h2 class="lead-modal-title">Get Your Dream Home Design</h2>
        <p class="lead-modal-subtitle">
          We'll create a photorealistic version of your design and send it directly to your email!
        </p>
      </div>

      <div class="lead-form-group">
        <label class="lead-form-label">Full Name *</label>
        <input 
          type="text" 
          id="leadNameInput" 
          class="lead-form-input" 
          placeholder="John Smith"
        >
        <p class="lead-error-message" id="leadNameError">Name is required</p>
      </div>

      <div class="lead-form-group">
        <label class="lead-form-label">Email Address *</label>
        <input 
          type="email" 
          id="leadEmailInput" 
          class="lead-form-input" 
          placeholder="john@example.com"
        >
        <p class="lead-error-message" id="leadEmailError">Please enter a valid email</p>
      </div>

      <div class="lead-form-group">
        <label class="lead-form-label">Phone Number *</label>
        <input 
          type="tel" 
          id="leadPhoneInput" 
          class="lead-form-input" 
          placeholder="(555) 123-4567"
        >
        <p class="lead-error-message" id="leadPhoneError">Please enter a valid phone number</p>
      </div>

      <button class="lead-submit-btn" id="leadSubmitBtn" onclick="window.handleLeadSubmit()">
        ‚ú® Generate My Design
      </button>

      <p class="lead-privacy-note">
        üîí Your information is secure and will only be used to send you your design images.
      </p>
    </div>
  </div>

  <!-- Application Scripts -->
  <script src="lead-generation.js"></script>
  <script type="module" src="app.js"></script>
  <script type="module" src="mobile-app.js"></script>
</body>
</html>
